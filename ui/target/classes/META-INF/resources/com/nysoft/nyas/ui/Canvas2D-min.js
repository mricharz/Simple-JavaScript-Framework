jQuery.require("com.nysoft.nyas.ui.Canvas");com.nysoft.nyas.ui.Canvas.extend("com.nysoft.nyas.ui.Canvas2D",{meta:{context:"object",objects:"object",measureCallback:"function"},init:function(a){this._super("init",a);if(this.getCanvas()){this.setContext(this.getCanvas().getContext("2d"))}this.fps=0;this.now=null;this.lastUpdate=(new Date)*1-1;this.fpsFilter=50},addObject:function(a){if(!this.getObjects()){this.setObjects([])}return this.getObjects().push(a)-1},clearCanvas:function(){this.getContext().save();this.getContext().setTransform(1,0,0,1,0,0);this.getContext().clearRect(0,0,this.getCanvas().width,this.getCanvas().height);this.getContext().restore()},renderObjects:function(){jQuery.each(this.getObjects(),jQuery.proxy(function(b,a){a.render(this,b)},this))},render:function(){this.renderObjects();this._measureFrame()},rerender:function(){this.clearCanvas();this.render()},_openImage:function(a,b){image=new Image();image.onload=b;image.src=a;return image},drawImage:function(b,a){tmpImage=this._openImage(b,jQuery.proxy(function(){this.getContext().drawImage(tmpImage,a.getX(),a.getY(),tmpImage.width,tmpImage.height)},this))},_measureFrame:function(){var a=1000/((this.now=new Date)-this.lastUpdate);this.fps+=(a-this.fps)/this.fpsFilter;this.lastUpdate=this.now*1-1;if(this.getMeasureCallback()){this.getMeasureCallback().call(this,this.fps)}},animate:function(a){this.rerender();return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1000/60)})(a)}});