jQuery.require("com.nysoft.nyas.core.BaseObject");jQuery.require("com.nysoft.nyas.core.Socket");com.nysoft.nyas.core.BaseObject.extend("com.nysoft.nyas.ui.Shell",{meta:{object:"object",user:"object",socketConnection:"object",tiles:"object",currentTileIndex:"number"},addTile:function(a){if(!this.getTiles()){this.setTiles([])}return this.getTiles().push(a)-1},getURLParameter:function(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},init:function(b,a){this.setUser(new com.nysoft.nyas.core.User({name:this.getURLParameter("name")}));this.setObject(b);this.setProperties(a);this.openSocket();this.drawShell();if(a.createTiles){jQuery.each(a.createTiles,jQuery.proxy(function(c,e){if(window[e]){var d=new window[e](null,{tilescontainer:this.tilescontainer,onOpen:jQuery.proxy(function(g){var f=null;jQuery.each(this.getTiles(),jQuery.proxy(function(h,i){if(g==i){f=h;return false}},this));this.setCurrentTileIndex(f)},this),onClose:jQuery.proxy(function(f){this.setCurrentTileIndex(null)},this)});d.draw(this.tilescontainer);this.addTile(d)}},this))}},addChatBoxBtn:function(a){if(!a){return}a=a.split(",");jQuery.each(a,jQuery.proxy(function(c,d){if(d&&d!=this.getUser().getName()){var b=jQuery('<li class="chatbox-btn">'+d+"</li>");this.chats.append(b)}},this))},remChatBoxBtn:function(a){if(!a){return}a=a.split(",");jQuery.each(a,jQuery.proxy(function(b,c){this.chats.find(".chatbox-btn").each(function(){if(jQuery(this).text()==c){this.remove()}})},this))},drawShell:function(){if(this.getObject()){var a=this.getObject().html('<div class="shell-bar"><a class="button home"><span>Home</span></a><ul class="chats"></ul></div><div class="tilescontainer"><h2>Willkommen im NySoft Testcenter</h2></div>');this.bar=a.children(".shell-bar");this.homeButton=this.bar.children(".button.home");this.chats=this.bar.children(".chats");this.tilescontainer=a.children(".tilescontainer");this.homeButton.click(jQuery.proxy(function(){var b=this.getCurrentTile();if(b){b.close()}},this))}},getCurrentTile:function(){if(this.getCurrentTileIndex()!==null){return this.getTiles()[this.getCurrentTileIndex()]}return null},socketReady:function(){if(this.getSocketConnection().getStatus()!=com.nysoft.nyas.core.Socket.Status.Opened){this.openSocket()}if(this.getSocketConnection().getStatus()==com.nysoft.nyas.core.Socket.Status.Opened){return true}return false},openSocket:function(){if(!this.getSocketConnection()){this.setSocketConnection(new com.nysoft.nyas.core.Socket({url:"ws://dev.nysoft.de:88",onOpen:jQuery.proxy(this.onSocketOpen,this),onError:jQuery.proxy(this.onSocketError,this),onMessage:jQuery.proxy(this.onSocketMessage,this)}))}if(this.getSocketConnection().getStatus()!=com.nysoft.nyas.core.Socket.Status.Connecting&&this.getSocketConnection().getStatus()!=com.nysoft.nyas.core.Socket.Status.Opened&&this.getSocketConnection().getStatus()!=com.nysoft.nyas.core.Socket.Status.Disconnecting){this.getSocketConnection().open()}},onSocketOpen:function(a){this.getSocketConnection().send("hello:"+this.getUser().getName())},onSocketError:function(a){alert(JSON.stringify(a))},onSocketMessage:function(b){console.log(b);var a=b.data.match(/^([^:]*):(.*)/);if(a.length>0){var c=a[2]||null;this[a[1]].call(this,b,c)}},userleft:function(b,a){this.remChatBoxBtn(a)},newuser:function(b,a){this.addChatBoxBtn(a)},userlist:function(b,a){this.addChatBoxBtn(a)}});com.nysoft.nyas.core.BaseObject.extend("com.nysoft.nyas.core.User",{meta:{name:"string"},init:function(a){this.setProperties(a)}});jQuery.require("com.nysoft.nyas.ui.Tile");com.nysoft.nyas.ui.Tile.extend("Canvas3DTextTestTile",{init:function(b,a){this.setTitle("Canvas 3D Text Test");this.setPlayground(jQuery('<canvas class="playarea" id="magicball-canvas" data-jsclass="com.nysoft.Canvas3DTextTest">'));this._super("init",b,a)}});com.nysoft.nyas.ui.Tile.extend("CanvasTextTestTile",{init:function(b,a){this.setTitle("Canvas Text Test");this.setPlayground(jQuery('<canvas class="playarea" id="memory-canvas" data-jsclass="com.nysoft.CanvasTextTest">'));this._super("init",b,a)}});com.nysoft.nyas.ui.Tile.extend("CanvasBasicObjectsTestTile",{init:function(b,a){this.setTitle("Canvas Basic Objects Test");this.setPlayground(jQuery('<canvas class="playarea" id="memory-canvas" data-jsclass="com.nysoft.CanvasBasicObjectsTest">'));this._super("init",b,a)}});com.nysoft.nyas.ui.Tile.extend("AccelerationRotationTestTile",{init:function(b,a){this.setTitle("Acceleration & Rotation Test");this.setPlayground(jQuery('<canvas class="playarea" id="memory-canvas" data-jsclass="com.nysoft.AccelerationRotationTest">'));this._super("init",b,a)}});com.nysoft.nyas.ui.Tile.extend("PuzzleTile",{init:function(b,a){jQuery.log.debug("PuzzleTile constructor");this.setPlayground(jQuery('<div class="playarea" id="puzzle-div" data-jsclass="Puzzle">'));this._super("init",b,a)}});com.nysoft.nyas.ui.Tile.extend("LabyrinthTile",{init:function(b,a){jQuery.log.debug("LabyrinthTile constructor");this.setPlayground(jQuery('<canvas class="playarea" id="labyrinth-canvas" data-jsclass="Labyrinth">'));this._super("init",b,a)}});com.nysoft.nyas.ui.Tile.extend("StatisticTile",{init:function(b,a){jQuery.log.debug("StatisticTile constructor");this.setPlayground(jQuery('<div class="playarea" id="statistic-canvas" data-jsclass="Statistic">'));this._super("init",b,a)}});